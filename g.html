<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Void Breaker | Ultimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #00f3ff; --neon-pink: #ff0055; --neon-purple: #bc13fe; --bg: #050508; }
        
        /* --- CORE SYSTEM: MOBİL KORUMA KATMANI --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; outline: none; margin: 0; padding: 0; cursor: default; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Orbitron', sans-serif; touch-action: none; }
        canvas { display: block; width: 100%; height: 100%; cursor: none; } /* Oyun içinde imleç gizlenir */

        /* --- UI KATMANLARI --- */
        #hud { position: fixed; inset: 0; pointer-events: none; z-index: 10; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .top-row { display: flex; justify-content: space-between; align-items: flex-start; }
        
        .stat-card { background: rgba(0,0,0,0.5); border-left: 3px solid var(--neon-blue); padding: 10px 15px; border-radius: 0 10px 10px 0; backdrop-filter: blur(5px); }
        .lbl { font-size: 10px; color: #aaa; letter-spacing: 2px; }
        .val { font-size: 24px; color: #fff; font-weight: 900; text-shadow: 0 0 10px var(--neon-blue); }

        .btn-exit { pointer-events: auto; background: rgba(255, 0, 85, 0.2); border: 1px solid var(--neon-pink); color: #fff; padding: 10px 25px; border-radius: 5px; font-family: 'Orbitron'; font-weight: 700; font-size: 12px; transition: 0.2s; cursor: pointer; text-shadow: 0 0 5px var(--neon-pink); }
        .btn-exit:active { background: var(--neon-pink); color: #000; }

        #health-bar-container { width: 100%; max-width: 300px; height: 8px; background: #333; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        #health-fill { width: 100%; height: 100%; background: var(--neon-blue); transition: width 0.2s; box-shadow: 0 0 10px var(--neon-blue); }

        /* --- MENÜLER --- */
        .screen { position: fixed; inset: 0; background: rgba(0,0,0,0.92); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(20px); transition: opacity 0.4s; }
        .panel { width: 90%; max-width: 450px; text-align: center; border: 1px solid rgba(255,255,255,0.1); padding: 40px; border-radius: 20px; background: linear-gradient(160deg, #101015, #000); box-shadow: 0 0 60px rgba(0, 243, 255, 0.15); position: relative; overflow: hidden; }
        .panel::before { content:''; position: absolute; top:0; left:0; width:100%; height:4px; background: linear-gradient(90deg, var(--neon-pink), var(--neon-blue)); }
        
        h1 { font-size: 32px; color: #fff; margin-bottom: 10px; letter-spacing: 3px; text-shadow: 0 0 20px var(--neon-blue); }
        p { color: #888; font-size: 12px; line-height: 1.6; margin-bottom: 30px; }
        
        .start-btn { width: 100%; padding: 20px; background: var(--neon-blue); color: #000; border: none; font-family: 'Orbitron'; font-weight: 900; font-size: 16px; cursor: pointer; border-radius: 5px; box-shadow: 0 0 20px rgba(0, 243, 255, 0.4); transition: transform 0.1s; }
        .start-btn:active { transform: scale(0.96); }

        .powerup-info { display: flex; justify-content: center; gap: 15px; margin-bottom: 25px; }
        .p-badge { font-size: 10px; padding: 5px 10px; border-radius: 4px; color: #000; font-weight: bold; }
    </style>
</head>
<body>

<div id="hud">
    <div class="top-row">
        <div>
            <div class="stat-card">
                <div class="lbl">SKOR</div>
                <div id="ui-score" class="val">0</div>
            </div>
            <div id="health-bar-container"><div id="health-fill"></div></div>
        </div>
        <button class="btn-exit" onclick="location.href='index.html'">AYRIL</button>
    </div>
    <div class="stat-card" style="align-self: flex-start; margin-top: auto; border-left-color: var(--neon-purple);">
        <div class="lbl">SİLAH DURUMU</div>
        <div id="ui-weapon" class="val" style="font-size: 16px; color: var(--neon-purple);">NORMAL</div>
    </div>
</div>

<div id="start-screen" class="screen">
    <div class="panel">
        <h1>VOID BREAKER</h1>
        <div class="powerup-info">
            <span class="p-badge" style="background:var(--neon-purple)">SCATTER</span>
            <span class="p-badge" style="background:var(--neon-blue)">SHIELD</span>
            <span class="p-badge" style="background:#00ff00">LASER</span>
        </div>
        <p>Parmağınla gemiyi yönet. Ateş otomatiktir.<br>Kaosun içinden sağ çıkabilir misin?</p>
        <button class="start-btn" id="btn-start">MOTORLARI BAŞLAT</button>
    </div>
</div>

<div id="game-over" class="screen" style="display:none; opacity:0;">
    <div class="panel">
        <h1 style="color:var(--neon-pink); text-shadow:0 0 20px var(--neon-pink);">SİSTEM ÇÖKTÜ</h1>
        <p>Void tarafından yutuldun.</p>
        <div id="final-score" style="font-size: 40px; color: #fff; margin: 20px 0; font-weight:900;">0</div>
        <button class="start-btn" onclick="location.reload()" style="background:var(--neon-pink); box-shadow:0 0 20px rgba(255,0,85,0.4);">YENİDEN BAŞLAT</button>
    </div>
</div>

<canvas id="c"></canvas>

<script>
/** * VOID BREAKER ENGINE v1.0
 * High Performance Canvas Renderer & Entity System
 */

const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d', { alpha: false }); // Optimizasyon

// OYUN AYARLARI
let state = { running: false, score: 0, frames: 0 };
let W, H;
let player = { x: 0, y: 0, hp: 100, maxHp: 100, weapon: 'normal', weaponTimer: 0, shield: false };
let input = { x: 0, y: 0, active: false };

// ENTITY HAVUZLARI
let bullets = [];
let enemies = [];
let particles = [];
let powerups = [];
let stars = [];

// SES SİSTEMİ (AudioContext)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function sfx(type) {
    if(audioCtx.state === 'suspended') audioCtx.resume();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    if(type === 'shoot') {
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    } else if(type === 'exp') {
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(100, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    } else if(type === 'power') {
        osc.type = 'sine';
        osc.frequency.setValueAtTime(600, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(1200, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.3);
        osc.start(); osc.stop(audioCtx.currentTime + 0.3);
    }
    osc.connect(gain); gain.connect(audioCtx.destination);
}

// BAŞLATMA
function init() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    player.x = W / 2;
    player.y = H - 150;
    input.x = player.x; input.y = player.y;

    // Yıldız Arkaplanı
    stars = [];
    for(let i=0; i<80; i++) stars.push({
        x: Math.random()*W, y: Math.random()*H, 
        s: Math.random()*2 + 0.5, v: Math.random()*3 + 0.5
    });
}

// INPUT HANDLERS (MOBİL & PC)
const moveHandler = (e) => {
    if(!state.running) return;
    e.preventDefault();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    
    // Gecikmesiz takip (Smooth Lerp yerine Direct Set daha tepkiseldir)
    input.x = clientX;
    input.y = clientY - 50; // Parmağın biraz üstünde dursun
};

canvas.addEventListener('touchmove', moveHandler, { passive: false });
canvas.addEventListener('mousemove', moveHandler);
canvas.addEventListener('touchstart', (e) => { if(state.running) input.active = true; }, {passive:false});
window.addEventListener('mousedown', () => input.active = true);
window.addEventListener('mouseup', () => input.active = false);
window.addEventListener('touchend', () => input.active = false);

// OYUN DÖNGÜSÜ
function update() {
    if(!state.running) return;
    state.frames++;

    // 1. OYUNCU HAREKETİ (Sınırlar dahil)
    player.x += (input.x - player.x) * 0.2; // Hafif yumuşatma
    player.y += (input.y - player.y) * 0.2;
    player.x = Math.max(20, Math.min(W-20, player.x));
    player.y = Math.max(20, Math.min(H-20, player.y));

    // 2. ATEŞ SİSTEMİ
    if(state.frames % (player.weapon === 'laser' ? 5 : 8) === 0) {
        sfx('shoot');
        if(player.weapon === 'normal') {
            bullets.push({x: player.x, y: player.y - 20, vx: 0, vy: -15, c: '#00f3ff', w: 3, h: 15});
        } else if(player.weapon === 'scatter') {
            bullets.push({x: player.x, y: player.y, vx: 0, vy: -15, c: '#bc13fe', w: 4, h: 12});
            bullets.push({x: player.x, y: player.y, vx: -3, vy: -14, c: '#bc13fe', w: 4, h: 12});
            bullets.push({x: player.x, y: player.y, vx: 3, vy: -14, c: '#bc13fe', w: 4, h: 12});
        } else if(player.weapon === 'laser') {
            bullets.push({x: player.x - 10, y: player.y, vx: 0, vy: -25, c: '#00ff00', w: 2, h: 40});
            bullets.push({x: player.x + 10, y: player.y, vx: 0, vy: -25, c: '#00ff00', w: 2, h: 40});
        }
    }

    // Silah Süresi
    if(player.weaponTimer > 0) {
        player.weaponTimer--;
        if(player.weaponTimer <= 0) {
            player.weapon = 'normal';
            document.getElementById('ui-weapon').innerText = "NORMAL";
            document.getElementById('ui-weapon').style.color = "var(--neon-blue)";
        }
    }

    // 3. MERMİLER
    for(let i=bullets.length-1; i>=0; i--) {
        let b = bullets[i];
        b.x += b.vx; b.y += b.vy;
        if(b.y < -50 || b.y > H+50) bullets.splice(i, 1);
    }

    // 4. DÜŞMAN OLUŞTURMA (Zorluk Artışı)
    if(state.frames % Math.max(20, 60 - Math.floor(state.score/500)) === 0) {
        const type = Math.random();
        let e = { x: Math.random() * (W-40) + 20, y: -50, hp: 1, type: 0, r: 15 };
        
        if(type > 0.8 && state.score > 200) { e.hp = 5; e.type = 1; e.r = 25; } // Tank
        else if(type > 0.6) { e.hp = 2; e.type = 2; e.r = 12; } // Hızlı
        
        enemies.push(e);
    }

    // 5. DÜŞMAN MANTIĞI & ÇARPIŞMA
    for(let i=enemies.length-1; i>=0; i--) {
        let e = enemies[i];
        
        // Hareket
        if(e.type === 1) e.y += 2; // Tank yavaş
        else if(e.type === 2) { e.y += 6; e.x += Math.sin(e.y/50)*3; } // Hızlı Zigzag
        else e.y += 4; // Normal

        // Oyuncuya çarpma
        let dist = Math.hypot(player.x - e.x, player.y - e.y);
        if(dist < player.r + e.r) {
            if(!player.shield) takeDamage(20);
            else { player.shield = false; document.getElementById('health-fill').style.background = "var(--neon-blue)"; }
            explode(e.x, e.y, 20, '#ff0055');
            enemies.splice(i, 1);
            sfx('exp');
            continue;
        }

        // Mermi çarpması
        for(let j=bullets.length-1; j>=0; j--) {
            let b = bullets[j];
            if(Math.hypot(b.x - e.x, b.y - e.y) < e.r + 5) {
                e.hp--;
                bullets.splice(j, 1);
                explode(b.x, b.y, 5, b.c); // Kıvılcım
                if(e.hp <= 0) {
                    state.score += (e.type+1) * 50;
                    explode(e.x, e.y, 15, '#ffae00');
                    sfx('exp');
                    
                    // Powerup Düşürme Şansı (%10)
                    if(Math.random() < 0.1) spawnPowerup(e.x, e.y);
                    
                    enemies.splice(i, 1);
                }
                break;
            }
        }
        if(e.y > H + 50) enemies.splice(i, 1);
    }

    // 6. POWERUPS
    for(let i=powerups.length-1; i>=0; i--) {
        let p = powerups[i];
        p.y += 3;
        if(Math.hypot(player.x - p.x, player.y - p.y) < 30) {
            applyPowerup(p.type);
            powerups.splice(i, 1);
            sfx('power');
        } else if(p.y > H + 50) powerups.splice(i, 1);
    }

    // 7. PARÇACIKLAR
    for(let i=particles.length-1; i>=0; i--) {
        let p = particles[i];
        p.x += p.vx; p.y += p.vy; p.life -= 0.05;
        if(p.life <= 0) particles.splice(i, 1);
    }

    // Yıldızlar
    stars.forEach(s => { s.y += s.v; if(s.y > H) s.y = 0; });

    // UI Güncelle
    document.getElementById('ui-score').innerText = state.score;
}

function spawnPowerup(x, y) {
    const r = Math.random();
    let type = 'scatter';
    let color = '#bc13fe';
    if(r < 0.33) { type = 'laser'; color = '#00ff00'; }
    else if(r < 0.66) { type = 'shield'; color = '#00f3ff'; }
    powerups.push({x, y, type, color});
}

function applyPowerup(type) {
    player.weaponTimer = 600; // 10 saniye (60fps)
    if(type === 'shield') {
        player.shield = true;
        player.hp = Math.min(player.hp + 20, 100);
        updateHealth();
        document.getElementById('health-fill').style.background = "#fff";
        document.getElementById('ui-weapon').innerText = "SHIELD ACTIVE";
    } else {
        player.weapon = type;
        document.getElementById('ui-weapon').innerText = type.toUpperCase();
        document.getElementById('ui-weapon').style.color = type === 'scatter' ? '#bc13fe' : '#00ff00';
    }
}

function takeDamage(amount) {
    player.hp -= amount;
    updateHealth();
    // Ekran Sarsıntısı Efekti
    ctx.translate(Math.random()*10-5, Math.random()*10-5);
    setTimeout(() => ctx.setTransform(1,0,0,1,0,0), 50);

    if(player.hp <= 0) gameOver();
}

function updateHealth() {
    document.getElementById('health-fill').style.width = player.hp + "%";
}

function explode(x, y, count, color) {
    for(let i=0; i<count; i++) {
        particles.push({
            x: x, y: y,
            vx: (Math.random()-0.5) * 10,
            vy: (Math.random()-0.5) * 10,
            life: 1.0,
            c: color
        });
    }
}

function gameOver() {
    state.running = false;
    document.getElementById('final-score').innerText = state.score;
    let go = document.getElementById('game-over');
    go.style.display = 'flex';
    setTimeout(() => go.style.opacity = 1, 50);
}

// ÇİZİM
function draw() {
    // Temizle (Hafif iz bırakarak hareket hissi ver)
    ctx.fillStyle = 'rgba(5, 5, 8, 0.4)';
    ctx.fillRect(0, 0, W, H);

    // Yıldızlar
    ctx.fillStyle = '#fff';
    stars.forEach(s => { ctx.fillRect(s.x, s.y, s.s, s.s); });

    // Powerups
    powerups.forEach(p => {
        ctx.shadowBlur = 15; ctx.shadowColor = p.color;
        ctx.fillStyle = p.color;
        ctx.beginPath(); ctx.arc(p.x, p.y, 10, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = '#fff'; ctx.font = '10px Arial'; ctx.fillText('?', p.x-3, p.y+4);
        ctx.shadowBlur = 0;
    });

    // Mermiler
    bullets.forEach(b => {
        ctx.fillStyle = b.c;
        ctx.shadowBlur = 10; ctx.shadowColor = b.c;
        ctx.fillRect(b.x - b.w/2, b.y, b.w, b.h);
        ctx.shadowBlur = 0;
    });

    // Düşmanlar
    enemies.forEach(e => {
        ctx.save();
        ctx.translate(e.x, e.y);
        ctx.fillStyle = e.type === 1 ? '#ff0055' : (e.type===2 ? '#ffae00' : '#aa00ff');
        ctx.beginPath();
        if(e.type === 1) { ctx.rect(-15, -15, 30, 30); } // Kare (Tank)
        else { ctx.moveTo(0, 15); ctx.lineTo(10, -10); ctx.lineTo(-10, -10); } // Üçgen
        ctx.fill();
        // Can Barı
        if(e.type === 1) {
            ctx.fillStyle = 'red'; ctx.fillRect(-15, -25, 30, 4);
            ctx.fillStyle = '#0f0'; ctx.fillRect(-15, -25, (e.hp/5)*30, 4);
        }
        ctx.restore();
    });

    // Parçacıklar
    particles.forEach(p => {
        ctx.fillStyle = p.c;
        ctx.globalAlpha = p.life;
        ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, Math.PI*2); ctx.fill();
        ctx.globalAlpha = 1;
    });

    // Oyuncu
    if(state.running) {
        ctx.save();
        ctx.translate(player.x, player.y);
        
        // Kalkan Efekti
        if(player.shield) {
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.arc(0, 0, 25, 0, Math.PI*2); ctx.stroke();
        }

        // Gemi Çizimi
        ctx.fillStyle = '#00f3ff';
        ctx.shadowBlur = 20; ctx.shadowColor = '#00f3ff';
        ctx.beginPath();
        ctx.moveTo(0, -20); ctx.lineTo(15, 15); ctx.lineTo(0, 5); ctx.lineTo(-15, 15);
        ctx.fill();
        
        // Motor Alevi
        ctx.fillStyle = `rgba(0, 243, 255, ${Math.random()})`;
        ctx.beginPath(); ctx.moveTo(-5, 15); ctx.lineTo(5, 15); ctx.lineTo(0, 25 + Math.random()*10); ctx.fill();
        
        ctx.restore();
    }

    requestAnimationFrame(draw);
    update();
}

// BAŞLAT BUTONU
document.getElementById('btn-start').onclick = () => {
    document.getElementById('start-screen').style.opacity = 0;
    setTimeout(() => {
        document.getElementById('start-screen').style.display = 'none';
        state.running = true;
        player.r = 15; // Hitbox
    }, 400);
    // Audio Context Kilidini Aç
    if(audioCtx.state === 'suspended') audioCtx.resume();
};

window.onload = () => { init(); draw(); };
window.onresize = init;

</script>
</body>
</html>
