<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Gravity Path | Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Syncopate:wght@700&family=Inter:wght@400;900&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00ff88; --bg: #050508; --danger: #ff0055; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; user-select: none; }
        body, html { width: 100%; height: 100%; overflow: hidden; background: var(--bg); font-family: 'Inter', sans-serif; touch-action: none; }
        
        #ui { position: fixed; inset: 0; pointer-events: none; z-index: 10; padding: 25px; display: flex; flex-direction: column; justify-content: space-between; }
        .top { display: flex; justify-content: space-between; align-items: center; }
        .score-box { background: rgba(255,255,255,0.03); padding: 10px 20px; border-radius: 12px; border: 1px solid rgba(0,255,136,0.2); backdrop-filter: blur(10px); }
        .lbl { font-size: 8px; color: #555; letter-spacing: 2px; font-weight: 900; }
        .val { font-family: 'Syncopate'; font-size: 24px; color: var(--neon); }
        
        .exit-btn { pointer-events: auto; background: rgba(255,0,85,0.1); border: 1px solid var(--danger); color: #fff; padding: 12px 24px; border-radius: 8px; font-size: 10px; font-weight: 900; cursor: pointer; transition: 0.2s; font-family: 'Syncopate'; }
        .exit-btn:active { background: var(--danger); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(20px); }
        .card { width: 85%; max-width: 400px; text-align: center; background: #0a0a0f; padding: 40px; border-radius: 30px; border: 1px solid #1a1a20; box-shadow: 0 0 50px rgba(0,255,136,0.1); }
        h1 { font-family: 'Syncopate'; color: var(--neon); font-size: 24px; margin-bottom: 15px; }
        p { color: #666; font-size: 13px; line-height: 1.6; margin-bottom: 30px; }
        .btn { width: 100%; padding: 20px; border-radius: 15px; border: none; background: var(--neon); color: #000; font-family: 'Syncopate'; font-weight: 900; cursor: pointer; }
        
        canvas { display: block; }
    </style>
</head>
<body>

<div id="ui">
    <div class="top">
        <div class="score-box">
            <div class="lbl">MESAFE</div>
            <div id="s-val" class="val">0</div>
        </div>
        <button class="exit-btn" onclick="location.href='index.html'">AYRIL</button>
    </div>
    <div class="score-box" style="width: fit-content; border-color: #333;">
        <div class="lbl">EN İYİ</div>
        <div id="b-val" class="val" style="color:#fff; font-size: 16px;">0</div>
    </div>
</div>

<div id="start-screen" class="overlay">
    <div class="card">
        <h1>GRAVITY PATH</h1>
        <p>Ekrana dokunarak yerçekimini değiştir.<br>Engellere çarpma, hızını koru!</p>
        <button class="btn" id="start-btn">SİSTEMİ BAŞLAT</button>
    </div>
</div>

<div id="game-over" class="overlay" style="display:none;">
    <div class="card">
        <h1 style="color:var(--danger)">VERİ KAYBI</h1>
        <div id="final-score" style="font-size: 48px; color: #fff; margin: 20px 0; font-family: 'Syncopate';">0</div>
        <button class="btn" onclick="location.reload()" style="background:var(--danger)">TEKRAR BAĞLAN</button>
    </div>
</div>

<canvas id="stage"></canvas>

<script>
const canvas = document.getElementById('stage');
const ctx = canvas.getContext('2d', { alpha: false });

let W, H;
let state = { running: false, score: 0, best: localStorage.getItem('sh_grav_best') || 0, speed: 6, frames: 0, shake: 0 };
let player = { x: 150, y: 0, r: 15, vy: 0, gravity: 0.6, direction: 1, trail: [] };
let obstacles = [];

function init() {
    W = canvas.width = window.innerWidth;
    H = canvas.height = window.innerHeight;
    player.y = H / 2;
    document.getElementById('b-val').innerText = state.best;
    obstacles = [];
    // Başlangıç engelleri
    for(let i=0; i<5; i++) spawnObstacle(W + i * 400);
}

function spawnObstacle(xPos) {
    const gap = 200;
    const minH = 50;
    const h = minH + Math.random() * (H - gap - minH * 2);
    
    // Tip 0: Alt/Üst blok, Tip 1: Orta engel
    const type = Math.random() > 0.7 ? 1 : 0;
    obstacles.push({
        x: xPos || W + 100,
        y: type === 0 ? (Math.random() > 0.5 ? 0 : H - h) : h,
        w: 40 + Math.random() * 40,
        h: type === 0 ? h : 60,
        type: type
    });
}

function flip() {
    if(!state.running) return;
    player.direction *= -1;
    state.shake = 10;
}

// Input (Mobile & PC)
window.addEventListener('mousedown', (e) => { if(e.target.tagName !== 'BUTTON') flip(); });
window.addEventListener('touchstart', (e) => { if(e.target.tagName !== 'BUTTON') { e.preventDefault(); flip(); } }, {passive: false});
window.addEventListener('keydown', (e) => { if(e.code === 'Space') flip(); });

function update() {
    if(!state.running) return;
    state.frames++;
    
    // Hız artışı
    state.speed += 0.001;

    // Oyuncu Fiziği
    player.vy += player.gravity * player.direction;
    player.y += player.vy;
    player.vy *= 0.95; // Sürtünme

    // Sınır Kontrolü
    if(player.y - player.r < 0 || player.y + player.r > H) {
        die();
    }

    // İz Efekti
    player.trail.push({x: player.x, y: player.y});
    if(player.trail.length > 10) player.trail.shift();

    // Engelleri Hareket Ettir
    for(let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= state.speed;

        // Çarpışma Testi
        if(player.x + player.r > o.x && player.x - player.r < o.x + o.w) {
            if(player.y + player.r > o.y && player.y - player.r < o.y + o.h) {
                die();
            }
        }

        if(o.x + o.w < -100) {
            obstacles.splice(i, 1);
            spawnObstacle();
        }
    }

    state.score = Math.floor(state.frames / 10);
    document.getElementById('s-val').innerText = state.score;
}

function die() {
    state.running = false;
    state.shake = 20;
    if(state.score > state.best) localStorage.setItem('sh_grav_best', state.score);
    document.getElementById('final-score').innerText = state.score;
    document.getElementById('game-over').style.display = 'flex';
}

function draw() {
    // Ekran Sarsıntısı
    ctx.save();
    if(state.shake > 0) {
        ctx.translate(Math.random()*state.shake, Math.random()*state.shake);
        state.shake *= 0.9;
    }

    ctx.fillStyle = '#050508';
    ctx.fillRect(0, 0, W, H);

    // Grid Arkaplan
    ctx.strokeStyle = 'rgba(255,255,255,0.02)';
    for(let i=0; i<W; i+=50) {
        ctx.beginPath(); ctx.moveTo(i - (state.frames*2 % 50), 0); ctx.lineTo(i - (state.frames*2 % 50), H); ctx.stroke();
    }

    // Engeller
    obstacles.forEach(o => {
        ctx.shadowBlur = 15; ctx.shadowColor = 'rgba(255,0,85,0.5)';
        ctx.fillStyle = varColor('--danger');
        ctx.fillRect(o.x, o.y, o.w, o.h);
        ctx.shadowBlur = 0;
    });

    // Trail
    player.trail.forEach((t, i) => {
        ctx.fillStyle = `rgba(0, 255, 136, ${i/10 * 0.3})`;
        ctx.beginPath(); ctx.arc(t.x, t.y, player.r * (i/10), 0, Math.PI*2); ctx.fill();
    });

    // Oyuncu
    ctx.shadowBlur = 20; ctx.shadowColor = varColor('--neon');
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();
    
    // Yön Oku
    ctx.fillStyle = varColor('--bg');
    ctx.beginPath();
    ctx.moveTo(player.x - 5, player.y);
    ctx.lineTo(player.x + 5, player.y);
    ctx.lineTo(player.x, player.y + (10 * player.direction));
    ctx.fill();

    ctx.restore();
    if(state.running) {
        update();
    }
    requestAnimationFrame(draw);
}

function varColor(name) {
    return getComputedStyle(document.documentElement).getPropertyValue(name).trim();
}

document.getElementById('start-btn').onclick = () => {
    document.getElementById('start-screen').style.display = 'none';
    state.running = true;
};

window.onload = () => { init(); draw(); };
window.onresize = init;
</script>
</body>
</html>
